{
  "info": {
    "_postman_id": "flood-alert-complete-api-2024",
    "name": "Flood Alert System - Complete API Collection",
    "description": "Collection ƒë·∫ßy ƒë·ªß ƒë·ªÉ test t·∫•t c·∫£ c√°c API c·ªßa h·ªá th·ªëng c·∫£nh b√°o l≈© l·ª•t\n\n**Base URL:** http://localhost:3001\n\n**Ch·ª©c nƒÉng ch√≠nh:**\n- üè• Health Check\n- üìß Email Alerts\n- ü§ñ AI Flood Alerts (Gemini)\n- üî• Firebase Data Management\n- üéØ Personalized Alerts\n- ‚öôÔ∏è Alert Settings & Auto Alert\n- üì± Telegram Bot Integration\n\n**C√°ch s·ª≠ d·ª•ng:**\n1. ƒê·∫£m b·∫£o server ƒëang ch·∫°y t·∫°i port 3001\n2. C·∫≠p nh·∫≠t bi·∫øn m√¥i tr∆∞·ªùng n·∫øu c·∫ßn\n3. Ch·∫°y t·ª´ng request ho·∫∑c to√†n b·ªô collection",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "üè• Health Check",
      "item": [
        {
          "name": "Get API Status",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/",
              "host": ["{{BASE_URL}}"],
              "path": [""]
            },
            "description": "Ki·ªÉm tra tr·∫°ng th√°i API v√† xem danh s√°ch t·∫•t c·∫£ endpoints"
          },
          "response": []
        }
      ]
    },
    {
      "name": "üìß Email Alerts",
      "item": [
        {
          "name": "Send Premium Alert (NEW ‚≠ê CM)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"to\": \"viettaiifptudh@gmail.com\",\n  \"alertData\": {\n    \"location\": \"ƒê√† N·∫µng\",\n    \"riskLevel\": \"CAO\",\n    \"alertLevel\": \"M·ª©c b√°o ƒë·ªông 3\",\n    \"waterLevel_cm\": 120,\n    \"maxWaterLevel\": 150,\n    \"threshold\": \"V∆∞·ª£t m·ª©c an to√†n 30cm\",\n    \"rateOfChange\": \"Nhanh\",\n    \"rateDetail\": \"+10cm / 5 ph√∫t\",\n    \"description\": \"R·∫§T NGUY HI·ªÇM\"\n  }\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/api/send-premium-alert",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "send-premium-alert"]
            },
            "description": "üî• NEW! Template email cao c·∫•p v·ªõi hi·ªÉn th·ªã theo CM. Responsive, ƒë·∫πp m·∫Øt, dashboard 3 cards. Y√™u c·∫ßu: to (email), alertData (object v·ªõi waterLevel_cm, maxWaterLevel, v.v.)"
          },
          "response": []
        },
        {
          "name": "Send Premium Alert (NEW ‚≠ê %)",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"to\": \"viettaiifptudh@gmail.com\",\n  \"alertData\": {\n    \"location\": \"H·∫£i Ch√¢u, ƒê√† N·∫µng\",\n    \"riskLevel\": \"TRUNG B√åNH\",\n    \"alertLevel\": \"M·ª©c b√°o ƒë·ªông 2\",\n    \"waterPercent\": 75,\n    \"threshold\": \"V∆∞·ª£t ng∆∞·ª°ng 70%\",\n    \"rateOfChange\": \"Trung b√¨nh\",\n    \"rateDetail\": \"+5% / 5 ph√∫t\",\n    \"description\": \"NGUY HI·ªÇM\"\n  }\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/api/send-premium-alert",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "send-premium-alert"]
            },
            "description": "üî• NEW! Template email cao c·∫•p v·ªõi hi·ªÉn th·ªã theo %. Fallback khi kh√¥ng c√≥ d·ªØ li·ªáu cm. Y√™u c·∫ßu: to (email), alertData (object v·ªõi waterPercent)"
          },
          "response": []
        },
        {
          "name": "Send Test Email",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"to\": \"test@example.com\"\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/api/send-test-email",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "send-test-email"]
            },
            "description": "G·ª≠i test email ƒë·ªÉ ki·ªÉm tra email service"
          },
          "response": []
        },
        {
          "name": "Send Custom Email",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"to\": \"user@example.com\",\n  \"subject\": \"C·∫£nh b√°o t√πy ch·ªânh\",\n  \"html\": \"<h1>N·ªôi dung email</h1><p>ƒê√¢y l√† email t√πy ch·ªânh</p>\"\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/api/send-email",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "send-email"]
            },
            "description": "G·ª≠i email v·ªõi n·ªôi dung t√πy ch·ªânh"
          },
          "response": []
        },
        {
          "name": "Send Flood Alert Email",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"to\": \"user@example.com\",\n  \"alertData\": {\n    \"location\": \"ƒê√† N·∫µng, Vi·ªát Nam\",\n    \"severity\": \"high\",\n    \"alertMessage\": \"C·∫£nh b√°o l≈© l·ª•t nghi√™m tr·ªçng\",\n    \"recommendations\": [\n      \"Di chuy·ªÉn ƒë·∫øn n∆°i cao\",\n      \"Chu·∫©n b·ªã ƒë·ªì ƒÉn v√† n∆∞·ªõc u·ªëng\",\n      \"Theo d√µi th√¥ng tin t·ª´ ch√≠nh quy·ªÅn\"\n    ]\n  }\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/api/send-flood-alert",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "send-flood-alert"]
            },
            "description": "G·ª≠i c·∫£nh b√°o l≈© l·ª•t qua email. Y√™u c·∫ßu: to (b·∫Øt bu·ªôc), alertData (object)"
          },
          "response": []
        },
        {
          "name": "Send Weather Update Email",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"to\": \"user@example.com\",\n  \"weatherData\": {\n    \"location\": \"ƒê√† N·∫µng\",\n    \"temp\": 28,\n    \"humidity\": 85,\n    \"description\": \"M∆∞a v·ª´a\",\n    \"windSpeed\": 15\n  }\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/api/send-weather-update",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "send-weather-update"]
            },
            "description": "G·ª≠i c·∫≠p nh·∫≠t th·ªùi ti·∫øt qua email. Y√™u c·∫ßu: to (b·∫Øt bu·ªôc), weatherData (object)"
          },
          "response": []
        }
      ]
    },
    {
      "name": "ü§ñ AI Flood Alerts (Gemini)",
      "item": [
        {
          "name": "Generate AI Flood Alert",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"current_percent\": 85,\n  \"previous_percent\": 70,\n  \"location\": \"ƒê√† N·∫µng, Vi·ªát Nam\",\n  \"timestamp\": \"2024-11-22T10:00:00Z\",\n  \"to\": \"viettaiifptudh@gmail.com\"\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/api/generate-flood-alert",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "generate-flood-alert"]
            },
            "description": "S·ª≠ d·ª•ng AI (Gemini) ƒë·ªÉ t·∫°o c·∫£nh b√°o th√¥ng minh. Y√™u c·∫ßu: current_percent (b·∫Øt bu·ªôc), location (b·∫Øt bu·ªôc), previous_percent, timestamp, to (email)"
          },
          "response": []
        }
      ]
    },
    {
      "name": "üî• Firebase Data",
      "item": [
        {
          "name": "Get All Sensors",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/api/firebase/sensors",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "firebase", "sensors"]
            },
            "description": "L·∫•y d·ªØ li·ªáu t·∫•t c·∫£ c√°c c·∫£m bi·∫øn t·ª´ Firebase"
          },
          "response": []
        },
        {
          "name": "Get Sensor By ID",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/api/firebase/sensors/{{SENSOR_ID}}",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "firebase", "sensors", "{{SENSOR_ID}}"]
            },
            "description": "L·∫•y d·ªØ li·ªáu c·ªßa m·ªôt c·∫£m bi·∫øn c·ª• th·ªÉ"
          },
          "response": []
        },
        {
          "name": "Write Firebase Data",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"path\": \"sensors/test-sensor\",\n  \"data\": {\n    \"waterLevel\": 150,\n    \"temperature\": 28,\n    \"humidity\": 85,\n    \"timestamp\": \"2024-11-22T10:00:00Z\"\n  }\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/api/firebase/write",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "firebase", "write"]
            },
            "description": "Ghi d·ªØ li·ªáu v√†o Firebase Realtime Database"
          },
          "response": []
        },
        {
          "name": "Check Firebase & Send Alert",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"sensorId\": \"sensor1\",\n  \"to\": \"user@example.com\"\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/api/check-firebase-and-alert",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "check-firebase-and-alert"]
            },
            "description": "Ki·ªÉm tra Firebase v√† g·ª≠i c·∫£nh b√°o n·∫øu ph√°t hi·ªán nguy hi·ªÉm. Y√™u c·∫ßu: sensorId (b·∫Øt bu·ªôc), to (t√πy ch·ªçn)"
          },
          "response": []
        },
        {
          "name": "Check IoT Data",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"sensorId\": \"SENSOR_ROAD\"\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/api/check-iot-data",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "check-iot-data"]
            },
            "description": "Ki·ªÉm tra d·ªØ li·ªáu IoT v√† g·ª≠i c·∫£nh b√°o n·∫øu c·∫ßn. Y√™u c·∫ßu: sensorId (SENSOR_ROAD ho·∫∑c SENSOR_SEWER)"
          },
          "response": []
        }
      ]
    },
    {
      "name": "üéØ Personalized Alerts",
      "item": [
        {
          "name": "Check User Locations Alert",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": \"{{USER_ID}}\",\n  \"minRiskLevel\": 1,\n  \"sendEmail\": true\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/api/check-user-locations-alert",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "check-user-locations-alert"]
            },
            "description": "Ki·ªÉm tra t·∫•t c·∫£ c√°c v·ªã tr√≠ c·ªßa user v√† g·ª≠i c·∫£nh b√°o n·∫øu c√≥ nguy hi·ªÉm. Y√™u c·∫ßu: userId (b·∫Øt bu·ªôc), minRiskLevel (0-3, m·∫∑c ƒë·ªãnh 1), sendEmail (true/false, m·∫∑c ƒë·ªãnh true)"
          },
          "response": []
        },
        {
          "name": "Get User Locations",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/api/user-locations/{{USER_ID}}",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "user-locations", "{{USER_ID}}"]
            },
            "description": "L·∫•y t·∫•t c·∫£ c√°c v·ªã tr√≠ ƒë√£ l∆∞u c·ªßa user"
          },
          "response": []
        },
        {
          "name": "Analyze Weather Alert",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"lat\": 16.0544,\n  \"lon\": 108.2022,\n  \"areaId\": \"da-nang-hai-chau\",\n  \"to\": \"user@example.com\",\n  \"minRiskLevel\": 1,\n  \"includeAllAreas\": false\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/api/analyze-weather-alert",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "analyze-weather-alert"]
            },
            "description": "Ph√¢n t√≠ch th·ªùi ti·∫øt v√† g·ª≠i c·∫£nh b√°o cho v·ªã tr√≠ c·ª• th·ªÉ. Y√™u c·∫ßu: lat (b·∫Øt bu·ªôc), lon (b·∫Øt bu·ªôc), areaId (t√πy ch·ªçn), to (email, t√πy ch·ªçn), minRiskLevel (0-3, m·∫∑c ƒë·ªãnh 1), includeAllAreas (true/false)"
          },
          "response": []
        },
        {
          "name": "Check Sensor Based Alert",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": \"{{USER_ID}}\",\n  \"sendEmail\": true\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/api/check-sensor-based-alert",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "check-sensor-based-alert"]
            },
            "description": "Ki·ªÉm tra c·∫£nh b√°o d·ª±a tr√™n d·ªØ li·ªáu c·∫£m bi·∫øn g·∫ßn v·ªã tr√≠ user. Y√™u c·∫ßu: userId (b·∫Øt bu·ªôc), sendEmail (true/false, m·∫∑c ƒë·ªãnh true)"
          },
          "response": []
        }
      ]
    },
    {
      "name": "‚öôÔ∏è Alert Settings & Auto Alert",
      "item": [
        {
          "name": "Get Alert Settings",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/api/alert-settings/{{USER_ID}}",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "alert-settings", "{{USER_ID}}"]
            },
            "description": "L·∫•y c·∫•u h√¨nh c·∫£nh b√°o t·ª± ƒë·ªông c·ªßa user"
          },
          "response": []
        },
        {
          "name": "Update Alert Settings",
          "request": {
            "method": "PUT",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"email\": \"user@example.com\",\n  \"enabled\": true,\n  \"checkIntervalMinutes\": 30,\n  \"sensorIds\": [\"SENSOR_ROAD\", \"SENSOR_SEWER\"],\n  \"threshold\": 80,\n  \"alertMethods\": {\n    \"email\": true,\n    \"telegram\": false\n  },\n  \"preferences\": {\n    \"maxDistance\": 5,\n    \"minWaterLevel\": 100,\n    \"notificationTime\": \"always\"\n  }\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/api/alert-settings/{{USER_ID}}",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "alert-settings", "{{USER_ID}}"]
            },
            "description": "C·∫≠p nh·∫≠t c·∫•u h√¨nh c·∫£nh b√°o t·ª± ƒë·ªông. C√≥ th·ªÉ g·ª≠i to√†n b·ªô settings object ho·∫∑c ch·ªâ c√°c field mu·ªën update"
          },
          "response": []
        },
        {
          "name": "Toggle Alert Settings",
          "request": {
            "method": "POST",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"enabled\": true\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/api/alert-settings/{{USER_ID}}/toggle",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "alert-settings", "{{USER_ID}}", "toggle"]
            },
            "description": "B·∫≠t/t·∫Øt c·∫£nh b√°o t·ª± ƒë·ªông. Y√™u c·∫ßu: enabled (true/false, b·∫Øt bu·ªôc)"
          },
          "response": []
        },
        {
          "name": "Delete Alert Settings",
          "request": {
            "method": "DELETE",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/api/alert-settings/{{USER_ID}}",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "alert-settings", "{{USER_ID}}"]
            },
            "description": "X√≥a c·∫•u h√¨nh c·∫£nh b√°o t·ª± ƒë·ªông"
          },
          "response": []
        },
        {
          "name": "Get Alert Logs",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/api/alert-settings/{{USER_ID}}/logs?limit=10",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "alert-settings", "{{USER_ID}}", "logs"],
              "query": [
                {
                  "key": "limit",
                  "value": "10",
                  "description": "S·ªë l∆∞·ª£ng logs t·ªëi ƒëa"
                }
              ]
            },
            "description": "L·∫•y l·ªãch s·ª≠ c·∫£nh b√°o ƒë√£ g·ª≠i"
          },
          "response": []
        },
        {
          "name": "Test Alert Now",
          "request": {
            "method": "POST",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/api/alert-settings/{{USER_ID}}/test",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "alert-settings", "{{USER_ID}}", "test"]
            },
            "description": "Test g·ª≠i c·∫£nh b√°o ngay l·∫≠p t·ª©c"
          },
          "response": []
        },
        {
          "name": "Get Scheduler Status",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/api/scheduler/status",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "scheduler", "status"]
            },
            "description": "L·∫•y tr·∫°ng th√°i c·ªßa scheduler service (auto alert)"
          },
          "response": []
        }
      ]
    },
    {
      "name": "üì± Telegram Bot",
      "item": [
        {
          "name": "Get Telegram QR Info",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/api/telegram/qr-info",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "telegram", "qr-info"]
            },
            "description": "L·∫•y th√¥ng tin ƒë·ªÉ t·∫°o QR code li√™n k·∫øt Telegram"
          },
          "response": []
        },
        {
          "name": "Get Bot Info",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/api/telegram/info",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "telegram", "info"]
            },
            "description": "L·∫•y th√¥ng tin chi ti·∫øt v·ªÅ Telegram bot"
          },
          "response": []
        },
        {
          "name": "Check Telegram Status",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "{{BASE_URL}}/api/telegram/status?userId={{USER_ID}}",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "telegram", "status"],
              "query": [
                {
                  "key": "userId",
                  "value": "{{USER_ID}}",
                  "description": "Firebase User ID"
                }
              ]
            },
            "description": "Ki·ªÉm tra tr·∫°ng th√°i li√™n k·∫øt Telegram c·ªßa user"
          },
          "response": []
        },
        {
          "name": "Unlink Telegram",
          "request": {
            "method": "DELETE",
            "header": [
              {
                "key": "Content-Type",
                "value": "application/json"
              }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"userId\": \"{{USER_ID}}\"\n}"
            },
            "url": {
              "raw": "{{BASE_URL}}/api/telegram/unlink",
              "host": ["{{BASE_URL}}"],
              "path": ["api", "telegram", "unlink"]
            },
            "description": "H·ªßy li√™n k·∫øt Telegram"
          },
          "response": []
        }
      ]
    }
  ],
  "variable": [
    {
      "key": "BASE_URL",
      "value": "http://localhost:4000",
      "type": "string"
    },
    {
      "key": "USER_ID",
      "value": "user123",
      "type": "string"
    },
    {
      "key": "SENSOR_ID",
      "value": "sensor1",
      "type": "string"
    }
  ]
}
